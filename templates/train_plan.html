<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>è¯¾ç¨‹è¿›åº¦</title>
    <link href="{{ url_for('static', filename='css/style1.css') }}" rel="stylesheet" type="text/css" />
    <link rel="icon" href="{{ url_for('static', filename='images/logo.ico') }}" type="image/x-icon"/>
    <script src="{{ url_for('static', filename='js/jquery-2.2.4.min.js') }}" type="text/javascript"></script>
</head>
<body>
<div class="wapper_box">
    <div class="header_box"></div>
    <div class="header_box1">
        <div class="header_box2">
            <a class="logo_box" href="{{ url_for('index') }}"><img src="{{ url_for('static', filename='images/logo1.jpg') }}"/></a>
            <ul class="nav_box">
                <li class="nav_1"><a class="nav_but" href="{{ url_for('personal_information') }}">ä¸ªäººä¸­å¿ƒ</a></li>
                <li class="nav_1"><a class="nav_but" href="{{ url_for('inbox') }}">æ¶ˆæ¯ä¸­å¿ƒ</a></li>
                <li class="nav_1"><a class="nav_but" href="{{ url_for('news_center') }}">è¯¾ç¨‹è®ºå›</a></li>
                <li class="nav_1"><a class="nav_but" href="{{ url_for('recommed') }}">è¯¾ç¨‹æ¨è</a></li>
                <li class="nav_1"><a class="nav_but" href="{{ url_for('course_selection') }}">é€‰è¯¾ä¸­å¿ƒ</a></li>
                <li class="nav_1"><a class="nav_but" href="{{ url_for('train_plan') }}">è¯¾ç¨‹è¿›åº¦</a></li>
                <li class="nav_1"><a class="nav_but" href="{{ url_for('index') }}">é¦–é¡µ</a></li>
            </ul>
        </div>
        <script>
            $(".nav_1").mouseenter(function(){
                $(this).find(".nav_slide").slideDown()
            });
            $(".nav_1").mouseleave(function(){
                $(".nav_slide").slideUp()
            });
        </script>
    </div>
</div>

<!-- è¯¾ç¨‹è¿›åº¦ä¸»ä½“å†…å®¹ -->
<div class="progress_container">
    <!-- é¡¶éƒ¨è¿›åº¦æ€»è§ˆ -->
    <div class="summary_cards">
        <div class="summary_card">
            <div class="summary_icon">ğŸ“š</div>
            <div class="summary_content">
                <div class="summary_value" id="summary-total">0</div>
                <div class="summary_label">è¯¾ç¨‹æ€»æ•°</div>
                        </div>
                    </div>
        <div class="summary_card">
            <div class="summary_icon">âœ…</div>
            <div class="summary_content">
                <div class="summary_value" id="summary-completed">0</div>
                <div class="summary_label">å·²å®Œæˆ</div>
                        </div>
                    </div>
        <div class="summary_card">
            <div class="summary_icon">â³</div>
            <div class="summary_content">
                <div class="summary_value" id="summary-in-progress">0</div>
                <div class="summary_label">è¿›è¡Œä¸­</div>
                        </div>
                    </div>
        <div class="summary_card warning_card">
            <div class="summary_icon">ğŸ•’</div>
            <div class="summary_content">
                <div class="summary_value" id="summary-pending">0</div>
                <div class="summary_label">å¾…å¼€å§‹</div>
                        </div>
                        </div>
                    </div>

    <!-- è¯¾ç¨‹è¿›åº¦è¯¦æƒ… -->
    <div class="courses_section">
        <div class="section_header">
            <h2 class="section_title">è¯¾ç¨‹è¿›åº¦è¯¦æƒ…</h2>
                        </div>
        <div id="courses-list" class="courses_list">
            <div class="loading">åŠ è½½ä¸­...</div>
                        </div>
                    </div>
                        </div>

<!-- æ¶ˆæ¯æç¤º -->
<div id="message" class="message_toast"></div>

<script>
$(function() {
    // åŠ è½½è¯¾ç¨‹è¿›åº¦æ•°æ®
    function loadCourseProgress() {
        $("#courses-list").html('<div class="loading">åŠ è½½ä¸­...</div>');
        $.ajax({
            url: "/api/get_course_progress_detail",
            type: "GET",
            success: function(res) {
                if (res.success && res.data) {
                    var summary = res.data.summary || {};
                    var courses = res.data.courses || [];
                    renderSummary(summary);
                    renderCourses(courses);
                } else {
                    $("#courses-list").html('<div class="error">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</div>');
                }
            },
            error: function() {
                $("#courses-list").html('<div class="error">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</div>');
            }
        });
    }

    // æ¸²æŸ“æ±‡æ€»
    function renderSummary(summary) {
        $("#summary-total").text(summary.total_courses || 0);
        $("#summary-completed").text(summary.completed || 0);
        $("#summary-in-progress").text(summary.in_progress || 0);
        $("#summary-pending").text(summary.pending || 0);
    }

    // æ¸²æŸ“è¯¾ç¨‹åˆ—è¡¨
    function renderCourses(courses) {
        if (!courses || courses.length === 0) {
            $("#courses-list").html('<div class="empty_state">æš‚æ— è¯¾ç¨‹è¿›åº¦æ•°æ®</div>');
            return;
        }
        var html = '';
        courses.forEach(function(course) {
            var statusClass = 'status_' + course.status;
            var warningBadge = course.near_due && course.status !== 'completed'
                ? '<span class="badge_warning">ä¸´è¿‘æˆªæ­¢</span>' : '';

            html += `
                <div class="course_card">
                    <div class="course_header">
                        <div>
                            <h3 class="course_title">${course.co_name}</h3>
                            <div class="course_meta">
                                <span class="meta_item">ä»»è¯¾æ•™å¸ˆï¼š${course.teacher}</span>
                                <span class="meta_item">ä¸Šè¯¾æ—¶é—´ï¼š${course.class_time}</span>
                    </div>
                        </div>
                        <div class="course_status">
                            <span class="status_badge ${statusClass}">${course.status_text}</span>
                            ${warningBadge}
                        </div>
                    </div>
                    <div class="course_progress">
                        <div class="progress_info">
                            <span class="progress_label">è¿›åº¦</span>
                            <span class="progress_value">${course.progress}%</span>
                        </div>
                        <div class="progress_bar_container">
                            <div class="progress_bar" style="width: ${course.progress}%;"></div>
                        </div>
                        <div class="progress_extra">
                            <span>å‘¨æ¬¡ï¼š${course.current_week} / ${course.total_weeks}</span>
                            <span>æœ€è¿‘ï¼š${course.recent_content}</span>
                        </div>
                    </div>
                    <div class="course_actions">
                        <a class="btn_link" href="#" onclick="showMessage('å³å°†è¿›å…¥è¯¾ç¨‹ï¼Œè¯·åœ¨è¯¾ç¨‹å¹³å°ä¸­ç»§ç»­å­¦ä¹ ', true); return false;">è¿›å…¥è¯¾ç¨‹</a>
                        <a class="btn_link secondary" href="#" onclick="showMessage('è¯¦æƒ…åŠŸèƒ½å¾…æ¥å…¥è¯¾ç¨‹å¹³å°', false); return false;">æŸ¥çœ‹è¯¦æƒ…</a>
                    </div>
                </div>
            `;
        });
        $("#courses-list").html(html);
    }

    // æ˜¾ç¤ºæ¶ˆæ¯
    window.showMessage = function(text, isSuccess) {
        var messageDiv = $("#message");
        messageDiv.text(text);
        messageDiv.removeClass("success error").addClass(isSuccess ? "success" : "error");
        messageDiv.fadeIn(200);

        setTimeout(function() {
            messageDiv.fadeOut(200);
        }, 3000);
    }

    // åˆå§‹åŒ–
    loadCourseProgress();
});
</script>

<style>
.progress_container {
    width: 1200px;
    margin: 30px auto;
    padding: 0 20px;
}

.summary_cards {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
    margin-bottom: 24px;
}

.summary_card {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    border-left: 4px solid #003d79;
}

.warning_card {
    border-left-color: #faad14;
}

.summary_icon {
    font-size: 28px;
}

.summary_value {
    font-size: 22px;
    font-weight: 700;
    color: #003d79;
}

.summary_label {
    font-size: 13px;
    color: #666;
}

.courses_section {
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    padding: 20px;
}

.section_header {
    margin-bottom: 16px;
    padding-bottom: 12px;
    border-bottom: 2px solid #003d79;
}

.section_title {
    margin: 0;
    font-size: 18px;
    font-weight: 600;
    color: #333;
}

.courses_list {
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.course_card {
    border: 1px solid #f0f0f0;
    border-radius: 8px;
    padding: 16px;
    background: #fff;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}

.course_header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 12px;
    margin-bottom: 12px;
}

.course_title {
    margin: 0 0 6px 0;
    font-size: 16px;
    font-weight: 600;
    color: #333;
}

.course_meta {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
    color: #666;
    font-size: 13px;
}

.meta_item {
    display: inline-flex;
    align-items: center;
    gap: 4px;
}

.course_status {
    display: flex;
    gap: 8px;
    align-items: center;
}

.status_badge {
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 500;
}

.status_in_progress { background: #e6f7ff; color: #1890ff; }
.status_completed { background: #f6ffed; color: #52c41a; }
.status_pending { background: #fff7e6; color: #fa8c16; }

.badge_warning {
    padding: 3px 8px;
    background: #fff1f0;
    color: #f5222d;
    border-radius: 10px;
    font-size: 12px;
    font-weight: 500;
}

.course_progress {
    margin: 10px 0;
}

.progress_info {
    display: flex;
    justify-content: space-between;
    margin-bottom: 6px;
    font-size: 13px;
    color: #666;
}

.progress_value {
    color: #003d79;
    font-weight: 600;
}

.progress_bar_container {
    width: 100%;
    height: 10px;
    background: #f0f0f0;
    border-radius: 6px;
    overflow: hidden;
}

.progress_bar {
    height: 100%;
    background: linear-gradient(90deg, #003d79, #1890ff);
    transition: width 0.3s ease;
}

.progress_extra {
    margin-top: 6px;
    display: flex;
    justify-content: space-between;
    font-size: 13px;
    color: #666;
}

.course_actions {
    margin-top: 10px;
    display: flex;
    gap: 12px;
}

.btn_link {
    color: #003d79;
    text-decoration: none;
    font-size: 13px;
    padding: 6px 12px;
    border: 1px solid #003d79;
    border-radius: 4px;
    transition: all 0.2s;
}

.btn_link:hover {
    background: #003d79;
    color: #fff;
}

.btn_link.secondary {
    border-color: #d0d7de;
    color: #666;
}

.btn_link.secondary:hover {
    background: #f5f7fa;
}

.loading, .error, .empty_state {
    text-align: center;
    padding: 40px 20px;
    color: #999;
    font-size: 14px;
}

.error { color: #f56c6c; }

.message_toast {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 15px 20px;
    border-radius: 6px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    z-index: 10001;
    min-width: 250px;
    display: none;
    font-size: 14px;
}

.message_toast.success { background: #52c41a; color: #fff; }
.message_toast.error { background: #f5222d; color: #fff; }

@media (max-width: 1280px) {
    .progress_container { width: 95%; }
    .summary_cards { grid-template-columns: repeat(2, 1fr); }
    .progress_extra { flex-direction: column; gap: 4px; }
}
</style>
</body>
</html>